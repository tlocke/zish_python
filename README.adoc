= A Python implementation of the Zish format
:toc: preamble


A Python 3 library for the https://github.com/tlocke/zish[Zish] format,
released under the
https://github.com/tlocke/zish_python/blob/master/LICENSE[MIT Licence].

image:https://travis-ci.org/tlocke/zish_python.svg?branch=master["Build Status",
link="https://travis-ci.org/tlocke/zish_python"]


=== Installation

It's a good idea to set up a virtualenv:

 virtualenv venv
 source venv/bin/activate

then install Zish with pip:

 pip install zish


=== Quickstart

To go from a Python object to an Zish string use `zish.dumps`. To go from an
Zish string to a Python object use `zish.loads`. Eg.

....
>>> from zish import loads, dumps
>>> from datetime import datetime, timezone
>>> from decimal import Decimal
>>>
>>> # Take a Python object
>>> book = {
...     'title': 'A Hero of Our Time',
...     'read_date': datetime(2017, 7, 16, 14, 5, tzinfo=timezone.utc),
...     'would_recommend': True,
...     'description': None,
...     'number_of_novellas': 5,
...     'price': Decimal('7.99'),
...     'weight': 6.88,
...     'key': b'kshhgrl',
...     'tags': ['russian', 'novel', '19th century']}
>>>
>>> # Output it as an Zish string
>>> zish_str = dumps(book)
>>> print(zish_str)
{
  "description": null,
  "key": 'a3NoaGdybA==',
  "number_of_novellas": 5,
  "price": 7.99,
  "read_date": 2017-07-16T14:05:00Z,
  "tags": [
    "russian",
    "novel",
    "19th century"],
  "title": "A Hero of Our Time",
  "weight": 6.88,
  "would_recommend": true}
>>>
>>> # Load the Zish string, to give us back the Python object
>>> reloaded_book = loads(zish_str)
>>> 
>>> # Print the title
>>> print(reloaded_book['title'])
A Hero of Our Time

....

.Python to Zish type mapping
|===
| Python Type | Zish Type

| bool
| bool

| int
| integer

| str
| string

| datetime.datetime
| timestamp

| dict
| map

| decimal.Decimal
| decimal

| float
| float

| bytearray, bytes
| bytes

| list, tuple
| list
|===


=== Release Notes


==== Version 0.0.21 (2018-01-04)

* Give a better error if the end of the document is reached before a map is
  completed.


==== Version 0.0.20 (2018-01-04)

* Give an error if there are multiple top-level values, rather than silently
  truncating.


==== Version 0.0.19 (2017-09-27)

* Decimal exponent dumped as `E` rather than `d`.


==== Version 0.0.18 (2017-09-12)

* Add tests for float formatting.


==== Version 0.0.17 (2017-09-12)

* Tighten up parsing of container types.
* Make sure floats are formatted without an uppercase E.


==== Version 0.0.16 (2017-09-06)

* Allow lists and sets as keys.


==== Version 0.0.15 (2017-09-05)

* Fixed map parsing bug where an error wasn't reported properly if it was
  expecting a `:` but got an integer.


==== Version 0.0.14 (2017-09-05)

* Fixed bug where sets couldn't be formatted.


==== Version 0.0.13 (2017-08-30)

* Performance improvement.


==== Version 0.0.12 (2017-08-30)

* Add Travis configuration.


==== Version 0.0.11 (2017-08-30)

* Give a better error message if a string isn't closed.


==== Version 0.0.10 (2017-08-29)

* New native parser that doesn't use antlr. It's about twice as fast.


==== Version 0.0.9 (2017-08-24)

* Fix bug where `int` was being parsed as `Decimal`.
* Make bytes type return a `bytes` rather than a `bytearray`.


==== Version 0.0.8 (2017-08-24)

* Container types aren't allowed as map keys.
* Performance improvements.


==== Version 0.0.7 (2017-08-22)

* Fix bug with UTC timestamp formatting.


==== Version 0.0.6 (2017-08-22)

* Fix bug in timestamp formatting.
* Add note about comments.


==== Version 0.0.5 (2017-08-18)

* Fix bug where `dumps` fails for a `tuple`.


==== Version 0.0.4 (2017-08-15)

* Simplify integer types.


==== Version 0.0.3 (2017-08-09)

* Fixed bug where interpreter couldn't find the `zish.antlr` package in eggs.
* Removed a few superfluous escape sequences.


==== Version 0.0.2 (2017-08-05)

* Now uses RFC3339 for timestamps.


==== Version 0.0.1 (2017-08-03)

* Fix bug where an EOF could cause an infinite loop.


==== Version 0.0.0 (2017-08-01)

* First public release. Passes all the tests.


=== Contributing

To run the tests:

* Change to the `zish` directory: `cd zish`
* Create a virtual environment: `virtualenv --python=python3 venv`
* Activate the virtual environment: `source venv/bin/activate`
* Install tox: `pip install tox`
* Run tox: `tox`


==== Making A New Release

Run `tox` to make sure all tests pass, then update the `Release Notes` section
then do:

....
git tag -a x.y.z -m "version x.y.z"
python setup.py sdist bdist_wheel upload --sign
....
